{"mappings":"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","sources":["<anon>","public/js/bundle.js","public/js/login.js","public/js/alert.js","public/js/mapbox.js","public/js/stripe.js","public/js/updateSettings.js"],"sourcesContent":["(() => {\nconst $9c087fcb18b83b71$export$516836c6a9dfc573 = ()=>{\n    const el = document.querySelector(\".alert\");\n    if (el) el.parentElement.removeChild(el);\n};\nconst $9c087fcb18b83b71$export$de026b00723010c1 = (type, message)=>{\n    $9c087fcb18b83b71$export$516836c6a9dfc573();\n    const markup = `<div class=\"alert alert--${type}\">${message}</div>`;\n    document.querySelector(\"body\").insertAdjacentHTML(\"afterbegin\", markup);\n    window.setTimeout($9c087fcb18b83b71$export$516836c6a9dfc573, 5000);\n};\n\n\nconst $94464591c703bfdb$export$596d806903d1f59e = async (email, password)=>{\n    try {\n        const res = await axios({\n            method: \"POST\",\n            url: \"/api/v1/users/Login\",\n            data: {\n                email: email,\n                password: password\n            }\n        });\n        if (res.data.status === \"success\") {\n            (0, $9c087fcb18b83b71$export$de026b00723010c1)(\"success\", \"Logged in successfully\");\n            window.setTimeout(()=>{\n                location.assign(\"/\");\n            }, 1500);\n        }\n    } catch (err) {\n        (0, $9c087fcb18b83b71$export$de026b00723010c1)(\"error\", err.response.data.message);\n    }\n};\nconst $94464591c703bfdb$export$a0973bcfe11b05c9 = async ()=>{\n    try {\n        const res = await axios({\n            method: \"GET\",\n            url: \"/api/v1/users/logout\"\n        });\n        if (res.data.status === \"success\") location.reload(true);\n    } catch (error) {\n        console.log(error.response);\n        (0, $9c087fcb18b83b71$export$de026b00723010c1)(\"error\", \"Error logging out! Try again.\");\n    }\n};\n\n\nconst $242002fbec7493b6$export$4c5dd147b21b9176 = (locations)=>{\n    mapboxgl.accessToken = \"pk.eyJ1IjoiaGVzaGFtMDAiLCJhIjoiY2xzdzAydDlpMXAweTJyczA2cWpzZ2gzbiJ9.gt9wRCmomeE98hD_9ijSJQ\";\n    const map = new mapboxgl.Map({\n        container: \"map\",\n        style: \"mapbox://styles/hesham00/clswpe7q7008801o30cab1099\",\n        scrollZoom: false\n    });\n    const bounds = new mapboxgl.LngLatBounds();\n    locations.forEach((loc)=>{\n        // create marker\n        const el = document.createElement(\"div\");\n        el.className = \"marker\";\n        //Add marker\n        new mapboxgl.Marker({\n            element: el,\n            anchor: \"bottom\"\n        }).setLngLat(loc.coordinates).addTo(map);\n        //Add popup\n        new mapboxgl.Popup({\n            offset: 30\n        }).setLngLat(loc.coordinates).setHTML(`<p>Day ${loc.day}: ${loc.description}</p>`).addTo(map);\n        //Extend map bounds to include current locations\n        bounds.extend(loc.coordinates);\n    });\n    map.fitBounds(bounds, {\n        padding: {\n            top: 200,\n            bottom: 150,\n            left: 100,\n            right: 100\n        }\n    });\n};\n\n\n\nconst $0dca30195359437d$export$8d5bdbf26681c0c2 = async (tourId)=>{\n    const stripe = Stripe(\"pk_test_51OybPQD20VeHaUlfNb8UZQL6aTt5AA3AS198xNQehRAQWSYnQBAkKrg3cKZzVT2n4Q6pM9IPJEa3hN6kZrXchFve00a8Xk59BE\");\n    try {\n        //1) Get checkout session from API\n        const session = await axios(`/api/v1/bookings/checkout-session/${tourId}`);\n        // console.log(session);\n        //2) Create checkout from + charge credit card\n        await stripe.redirectToCheckout({\n            sessionId: session.data.session.id\n        });\n    } catch (err) {\n        console.log(err);\n        (0, $9c087fcb18b83b71$export$de026b00723010c1)(\"error\", err);\n    }\n};\n\n\n\nconst $f9cf3b0bbad468db$export$f558026a994b6051 = async (data, type)=>{\n    try {\n        const url = type === \"password\" ? \"/api/v1/users/updateMyPassword\" : \"/api/v1/users/updateMe\";\n        const res = await axios({\n            method: \"PATCH\",\n            url: url,\n            data: data\n        });\n        if (res.data.status === \"success\") (0, $9c087fcb18b83b71$export$de026b00723010c1)(\"success\", `${type} updated successfully!`);\n    } catch (err) {\n        (0, $9c087fcb18b83b71$export$de026b00723010c1)(\"error\", err.response.data.message);\n    }\n};\n\n\n//Dom elements\nconst $d7cb951c2c940c68$var$mapBox = document.getElementById(\"map\");\nconst $d7cb951c2c940c68$var$loginForm = document.querySelector(\".form--login\");\nconst $d7cb951c2c940c68$var$logOutBtn = document.querySelector(\".nav__el--logout\");\nconst $d7cb951c2c940c68$var$userDataForm = document.querySelector(\".form-user-data\");\nconst $d7cb951c2c940c68$var$userPasswordForm = document.querySelector(\".form-user-password\");\nconst $d7cb951c2c940c68$var$bookBtn = document.getElementById(\"book-tour\");\n//Delegation\nif ($d7cb951c2c940c68$var$mapBox) {\n    const locations = JSON.parse($d7cb951c2c940c68$var$mapBox.dataset.locations);\n    (0, $242002fbec7493b6$export$4c5dd147b21b9176)(locations);\n}\nif ($d7cb951c2c940c68$var$loginForm) $d7cb951c2c940c68$var$loginForm.addEventListener(\"submit\", (e)=>{\n    e.preventDefault();\n    const email = document.getElementById(\"email\").value;\n    const password = document.getElementById(\"password\").value;\n    (0, $94464591c703bfdb$export$596d806903d1f59e)(email, password);\n});\nif ($d7cb951c2c940c68$var$logOutBtn) $d7cb951c2c940c68$var$logOutBtn.addEventListener(\"click\", (0, $94464591c703bfdb$export$a0973bcfe11b05c9));\nif ($d7cb951c2c940c68$var$userDataForm) $d7cb951c2c940c68$var$userDataForm.addEventListener(\"submit\", (e)=>{\n    e.preventDefault();\n    const form = new FormData();\n    form.append(\"name\", document.getElementById(\"name\").value);\n    form.append(\"email\", document.getElementById(\"email\").value);\n    form.append(\"photo\", document.getElementById(\"photo\").files[0]);\n    (0, $f9cf3b0bbad468db$export$f558026a994b6051)(form, \"data\");\n});\nif ($d7cb951c2c940c68$var$userPasswordForm) $d7cb951c2c940c68$var$userPasswordForm.addEventListener(\"submit\", async (e)=>{\n    e.preventDefault();\n    document.querySelector(\".btn--save-password\").textContent = \"Updating...\";\n    const passwordCurrent = document.getElementById(\"password-current\").value;\n    const password = document.getElementById(\"password\").value;\n    const passwordConfirm = document.getElementById(\"password-confirm\").value;\n    await (0, $f9cf3b0bbad468db$export$f558026a994b6051)({\n        passwordCurrent: passwordCurrent,\n        password: password,\n        passwordConfirm: passwordConfirm\n    }, \"password\");\n    document.querySelector(\".btn--save-password\").textContent = \"SAVE PASSWORD\";\n    document.getElementById(\"password-current\").value = \"\";\n    document.getElementById(\"password\").value = \"\";\n    document.getElementById(\"password-confirm\").value = \"\";\n});\nif ($d7cb951c2c940c68$var$bookBtn) $d7cb951c2c940c68$var$bookBtn.addEventListener(\"click\", (e)=>{\n    e.target.textContent = \"Processing...\";\n    const { tourId: tourId } = e.target.dataset;\n    (0, $0dca30195359437d$export$8d5bdbf26681c0c2)(tourId);\n});\n\n})();\n//# sourceMappingURL=bundle.js.map\n","import { login, logout } from './login.js';\nimport { displayMap } from './mapbox.js';\nimport { bookTour } from './stripe.js';\nimport { updateSettings } from './updateSettings.js';\n//Dom elements\nconst mapBox = document.getElementById('map');\nconst loginForm = document.querySelector('.form--login');\nconst logOutBtn = document.querySelector('.nav__el--logout');\nconst userDataForm = document.querySelector('.form-user-data');\nconst userPasswordForm = document.querySelector('.form-user-password');\nconst bookBtn = document.getElementById('book-tour');\n//Delegation\nif (mapBox) {\n  const locations = JSON.parse(mapBox.dataset.locations);\n  displayMap(locations);\n}\n\nif (loginForm) {\n  loginForm.addEventListener('submit', (e) => {\n    e.preventDefault();\n    const email = document.getElementById('email').value;\n    const password = document.getElementById('password').value;\n    login(email, password);\n  });\n}\n\nif (logOutBtn) logOutBtn.addEventListener('click', logout);\n\nif (userDataForm)\n  userDataForm.addEventListener('submit', (e) => {\n    e.preventDefault();\n    const form = new FormData();\n    form.append('name', document.getElementById('name').value);\n    form.append('email', document.getElementById('email').value);\n    form.append('photo', document.getElementById('photo').files[0]);\n\n    updateSettings(form, 'data');\n  });\nif (userPasswordForm)\n  userPasswordForm.addEventListener('submit', async (e) => {\n    e.preventDefault();\n    document.querySelector('.btn--save-password').textContent = 'Updating...';\n\n    const passwordCurrent = document.getElementById('password-current').value;\n    const password = document.getElementById('password').value;\n    const passwordConfirm = document.getElementById('password-confirm').value;\n    await updateSettings(\n      { passwordCurrent, password, passwordConfirm },\n      'password',\n    );\n\n    document.querySelector('.btn--save-password').textContent = 'SAVE PASSWORD';\n    document.getElementById('password-current').value = '';\n    document.getElementById('password').value = '';\n    document.getElementById('password-confirm').value = '';\n  });\n\nif (bookBtn)\n  bookBtn.addEventListener('click', (e) => {\n    e.target.textContent = 'Processing...';\n    const { tourId } = e.target.dataset;\n    bookTour(tourId);\n  });\n","import { showAlert } from './alert.js';\n\nexport const login = async (email, password) => {\n  try {\n    const res = await axios({\n      method: 'POST',\n      url: '/api/v1/users/Login',\n      data: {\n        email,\n        password,\n      },\n    });\n    if (res.data.status === 'success') {\n      showAlert('success', 'Logged in successfully');\n      window.setTimeout(() => {\n        location.assign('/');\n      }, 1500);\n    }\n  } catch (err) {\n    showAlert('error', err.response.data.message);\n  }\n};\n\nexport const logout = async () => {\n  try {\n    const res = await axios({\n      method: 'GET',\n      url: '/api/v1/users/logout',\n    });\n    if (res.data.status === 'success') location.reload(true);\n  } catch (error) {\n    console.log(error.response)\n    showAlert('error', 'Error logging out! Try again.');\n  }\n};\n","export const hideAlert = () => {\n  const el = document.querySelector('.alert');\n  if (el) el.parentElement.removeChild(el);\n};\n\n// type is 'success' or 'error'\nexport const showAlert = (type, message) => {\n  hideAlert();\n  const markup = `<div class=\"alert alert--${type}\">${message}</div>`;\n  document.querySelector('body').insertAdjacentHTML('afterbegin', markup);\n  window.setTimeout(hideAlert, 5000);\n};\n","\nexport const displayMap = (locations) => {\n  mapboxgl.accessToken =\n    'pk.eyJ1IjoiaGVzaGFtMDAiLCJhIjoiY2xzdzAydDlpMXAweTJyczA2cWpzZ2gzbiJ9.gt9wRCmomeE98hD_9ijSJQ';\n  const map = new mapboxgl.Map({\n    container: 'map', // container ID\n    style: 'mapbox://styles/hesham00/clswpe7q7008801o30cab1099', // style URL\n    scrollZoom: false,\n  });\n\n  const bounds = new mapboxgl.LngLatBounds();\n\n  locations.forEach((loc) => {\n    // create marker\n    const el = document.createElement('div');\n    el.className = 'marker';\n\n    //Add marker\n    new mapboxgl.Marker({\n      element: el,\n      anchor: 'bottom',\n    })\n      .setLngLat(loc.coordinates)\n      .addTo(map);\n\n    //Add popup\n    new mapboxgl.Popup({\n      offset: 30,\n    })\n      .setLngLat(loc.coordinates)\n      .setHTML(`<p>Day ${loc.day}: ${loc.description}</p>`)\n      .addTo(map);\n\n    //Extend map bounds to include current locations\n    bounds.extend(loc.coordinates);\n  });\n\n  map.fitBounds(bounds, {\n    padding: {\n      top: 200,\n      bottom: 150,\n      left: 100,\n      right: 100,\n    },\n  });\n};\n","import { showAlert } from './alert.js';\n\nexport const bookTour = async (tourId) => {\n  const stripe = Stripe(\n    'pk_test_51OybPQD20VeHaUlfNb8UZQL6aTt5AA3AS198xNQehRAQWSYnQBAkKrg3cKZzVT2n4Q6pM9IPJEa3hN6kZrXchFve00a8Xk59BE',\n  );\n\n  try {\n    //1) Get checkout session from API\n    const session = await axios(\n      `/api/v1/bookings/checkout-session/${tourId}`,\n    );\n    // console.log(session);\n\n    //2) Create checkout from + charge credit card\n    await stripe.redirectToCheckout({\n      sessionId: session.data.session.id,\n    });\n  } catch (err) {\n    console.log(err);\n    showAlert('error', err);\n  }\n};","import { showAlert } from './alert.js';\n\n//type is either password or data\nexport const updateSettings = async (data, type) => {\n  try {\n    const url =\n      type === 'password'\n        ? '/api/v1/users/updateMyPassword'\n        : '/api/v1/users/updateMe';\n    const res = await axios({\n      method: 'PATCH',\n      url,\n      data,\n    });\n    if (res.data.status === 'success')\n      showAlert('success', `${type} updated successfully!`);\n  } catch (err) {\n    showAlert('error', err.response.data.message);\n  }\n};\n"],"names":["$9c087fcb18b83b71$export$516836c6a9dfc573","el","document","querySelector","parentElement","removeChild","$9c087fcb18b83b71$export$de026b00723010c1","type","message","markup","insertAdjacentHTML","window","setTimeout","$94464591c703bfdb$export$596d806903d1f59e","email","password","res","axios","method","url","data","status","location","assign","err","response","$94464591c703bfdb$export$a0973bcfe11b05c9","reload","error","console","log","$0dca30195359437d$export$8d5bdbf26681c0c2","tourId","stripe","Stripe","session","redirectToCheckout","sessionId","id","$f9cf3b0bbad468db$export$f558026a994b6051","$d7cb951c2c940c68$var$mapBox","getElementById","$d7cb951c2c940c68$var$loginForm","$d7cb951c2c940c68$var$logOutBtn","$d7cb951c2c940c68$var$userDataForm","$d7cb951c2c940c68$var$userPasswordForm","$d7cb951c2c940c68$var$bookBtn","locations","mapboxgl","accessToken","map","Map","container","style","scrollZoom","bounds","LngLatBounds","forEach","loc","createElement","className","Marker","element","anchor","setLngLat","coordinates","addTo","Popup","offset","setHTML","day","description","extend","fitBounds","padding","top","bottom","left","right","JSON","parse","dataset","addEventListener","e","preventDefault","value","form","FormData","append","files","textContent","passwordCurrent","passwordConfirm","target"],"version":3,"file":"bundle.js.map"}